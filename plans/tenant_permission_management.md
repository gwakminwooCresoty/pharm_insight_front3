# 프랜차이즈 권한 관리 시스템 기획안

## 1. 개요
플랫폼 관리자에서 각 프랜차이즈(고객사, 프랜차이즈 본사, 약국 등)별로 접근 가능한 메뉴와 기능의 권한을 효율적이고 유연하게 제어하기 위한 권한 부여 체계(Authorization Model) 기획안입니다.

---

## 2. 3단계 권한 부여 방식 (Hierarchical Permission Model)
운영 효율성과 세밀한 제어를 모두 만족하기 위해 아래 **3가지 방식의 조합**으로 권한을 구성합니다.

### 2.1. 기본 권한 (DEFAULT Role)
* **개념**: 프랜차이즈 생성 시 기본적으로 접근이 허용되어야 하는 최소한의 필수 메뉴 집합입니다.
* **동작**: 시스템 설정에 'DEFAULT' 역할로 미리 메뉴들이 세팅되어 있으며, 프랜차이즈 상세 관리 화면에서 토글 버튼(`[ON/OFF]`)을 통해 일괄 적용하거나 해제할 수 있습니다.
* **장점**: 모든 프랜차이즈에게 부여해야 하는 공통 권한을 매번 세팅할 필요가 없어 관리자 리소스가 절약됩니다.

### 2.2. 그룹화된 권한 (Group-based / Role-based Permissions)
* **개념**: 특정 업무 목적이나 계약 등급에 따라 연관된 메뉴들을 하나의 **'권한 그룹(역할)'**으로 묶어 부여하는 방식입니다.
* **예시 시나리오**:
  * **프리미엄 요금제 그룹**: A메뉴(상세 통계), B메뉴(고급 리포트), C메뉴(API 연동)
  * **정산 담당 그룹**: D메뉴(세금계산서 발급), E메뉴(매출 정산 현황)
* **동작**: 여러 단일 메뉴를 하나하나 선택할 필요 없이, 미리 만들어진 권한 그룹을 체크박스로 다중 선택(Multi-select)하여 프랜차이즈에게 부여합니다. 
* **장점**: 표준화된 권한 세트를 제공하므로, 권한 부여가 매우 빠르고 휴먼 에러를 방지할 수 있습니다.

### 2.3. 개별 메뉴 권한 (Individual / Custom Menu Permissions)
* **개념**: 기본 권한이나 그룹 권한의 틀에 속하지 않는 예외적인 상황에 대응하기 위해, 가장 작은 단위인 **단일 메뉴** 각각에 대한 접근을 켜고 끌 수 있는 기능입니다.
* **동작**: 플랫폼 관리자 화면의 **[권한 상세 설정 (트리 뷰)]**에서 체크박스를 클릭하여 특정 프랜차이즈에게만 메뉴를 열어주거나(Add) 닫을 수(Remove) 있습니다.
* **장점**: "A 그룹 권한을 주고 싶은데, 그 그룹의 기능 중 C 메뉴 하나만 빼고 싶다"와 같은 복잡한 비즈니스 요구사항을 유연하게 수용할 수 있습니다.

---

## 3. 최종 권한 평가 로직 (Permission Resolution)

사용자(프랜차이즈 소속)가 메뉴에 접근할 때 시스템이 권한을 최종적으로 판단하는 공식은 다음과 같습니다. 합집합 방식으로 권한을 결합하고, 명시적 제외(Deny)를 우선 처리합니다.

> **최종 허용 메뉴 = ( DEFAULT 메뉴 ∪ 부여된 그룹들의 메뉴들 ∪ 추가로 허용된 개별 메뉴 ) - 명시적으로 차단된 개별 메뉴**

---

## 4. UI/UX 디자인 방안 (플랫폼 관리자 화면)

해당 기능을 UI로 풀어낼 때의 화면 구성도 제안입니다. (프랜차이즈 상세 > [권한 설정] 탭)

1. **기본 설정 (Quick Preset)**
   * `[Toggle 스위치]` **기본 권한 (DEFAULT) 적용** (초기값: ON) - *OFF 시 기본 메뉴도 안 보이게 처리 가능*

2. **그룹 권한 설정 (Role Groups)**
   * `[Checkbox 멀티선택]` 적용할 권한 그룹을 선택하세요.
   * ☑️ 영업자 관리 그룹 (메뉴 10개)
   * 🔲 프리미엄 통계 그룹 (메뉴 5개)
   * 🔲 정산 전용 그룹 (메뉴 2개)

3. **상세 개별 권한 제어 (Advanced Permission Override)**
   * 좌측 메뉴 구조와 동일한 **트리(Tree) 컴포넌트** 제공.
   * **[시각적 상태 구분]**:
     * 🟩 **회색 체크 상태 (Disabled & Checked)**: DEFAULT나 '그룹 권한'에 의해 이미 허용된 메뉴. (클릭하여 강제 제외 가능)
     * 🟦 **파란색 체크 상태 (Active Checked)**: 그룹에는 없지만 '개별적으로 추가 허용'한 메뉴.
     * 🟥 **빨간색 X 상태 (Blocked)**: 그룹 권한에는 포함되어 있으나, 이 프랜차이즈에 한해서만 명시적으로 '차단'시킨 메뉴.
     * ⬜ **빈 상태 (Unchecked)**: 아무 권한도 부여되지 않아 보이지 않는 메뉴.

---

## 5. 데이터베이스(ERD) 설계 방향 (참고용)

이 구조를 뒷받침하기 위한 백엔드/DB 테이블 설계 요건입니다.

* `roles` (권한 그룹 목록: DEFAULT 포함)
* `menus` (시스템 전체 메뉴 및 기능 ID 목록)
* `role_menu_mappings` (어떤 권한 그룹이 어떤 메뉴들을 포함하는 지 매핑)
* `franchise_role_mappings` (프랜차이즈에게 부여된 역할 그룹들 연결)
* `franchise_menu_exceptions` (프랜차이즈 개별 수준에서의 예외 처리)
  * 필드: `franchise_id`, `menu_id`, `is_granted` (true면 개별 추가 허용, false면 그룹 상관없이 강제 차단)
